<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Viewer — Protected embed</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  :root { --bg:#000; --text:#e6f0f3; }
  html,body{height:100%;margin:0;font-family:system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}
  #jaas{height:100vh;background:var(--bg);position:relative;overflow:hidden;width:100vw;}
  .viewer-controls{position:absolute;right:12px;top:12px;z-index:9999;display:none;gap:8px;align-items:center;}
  .viewer-controls button{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:8px 10px;color:var(--text);border-radius:6px;cursor:pointer;font-size:13px;}
  #status{position:absolute;left:12px;top:12px;z-index:9999;font-size:13px;color:#9fb2b8;}
  #meetFrame{width:100%;height:100vh;border:0;display:block;background:var(--bg);}
</style>
</head>
<body>
  <div id="jaas" aria-label="meeting">
    <div id="status">Connecting…</div>
    <div class="viewer-controls" id="viewerControls">
      <button id="btnFullscreen">Fullscreen</button>
    </div>
  </div>

<script>
(async function(){
  const SERVICE_BASE = "https://oor-islive.onrender.com"; // your server
  const ROOM = "AyushLive";

  const statusEl = document.getElementById('status');
  const viewerControls = document.getElementById('viewerControls');
  const setStatus = txt => { if(statusEl) statusEl.textContent = txt; };

  async function requestAndEmbed(){
    setStatus('Requesting join link…');
    try {
      const resp = await fetch(`${SERVICE_BASE}/api/request-join`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({room:ROOM})
      });
      if(!resp.ok){ setStatus('Server rejected'); return; }
      const data = await resp.json();
      if(!data?.joinUrl){ setStatus('Failed to get join link'); return; }

      setStatus('Embedding meeting…');
      const iframe = document.createElement('iframe');
      iframe.id='meetFrame';
      iframe.src = `${SERVICE_BASE}/join/${data.joinUrl.split('/').pop()}`; // /join/:jti
      iframe.allow='camera; microphone; fullscreen; clipboard-write';
      iframe.sandbox='allow-scripts allow-same-origin allow-forms allow-popups';

      const jaas = document.getElementById('jaas');
      jaas.innerHTML='';
      jaas.appendChild(iframe);

      if(viewerControls) viewerControls.style.display='flex';
      setStatus('Joined');

    } catch(e){ console.error(e); setStatus('Network error'); }
  }

  // fullscreen button
  document.getElementById('btnFullscreen').addEventListener('click', ()=>{
    const el = document.getElementById('jaas');
    if(el.requestFullscreen) el.requestFullscreen();
    else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  });

  window.addEventListener('load', requestAndEmbed);
})();
</script>
</body>
</html>
